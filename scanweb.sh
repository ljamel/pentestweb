#!/bin/bash

perform_scan() {
    website="$1"

    web_server=$(curl -sI "$website" | grep -i '^server:' | awk '{print $2}')

    if [ $# -ne 1 ]; then
        echo "Usage: $0 <url> "
        exit 1
    fi
    echo "Web server software: $web_server"

    echo "Scanning for CVEs related to $web_server..."
    perform_cve_check "$web_server"
}

perform_cve_check() {
    software="$1"
    
    # Parsing JSON for CVEs related to the provided software
    cves=$(jq '.sources[].name' cvelist.json | grep $software)
echo $cves
    if [ -z "$cves" ]; then
        echo "No CVEs found for $software"
    else
        echo "CVEs found for $software:"
        echo "$cves"
    fi

}

check_dependencies() {
    if ! command -v curl &> /dev/null; then
        echo "curl is required to run this script. Please install curl and try again."
        exit 1
    fi

    if ! command -v jq &> /dev/null; then
        echo "jq is required to run this script. Please install jq and try again."
        exit 1
    fi
}

# Check for dependencies
check_dependencies

# Perform the CVE scan
perform_scan "$1"
